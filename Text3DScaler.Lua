local Text3DScaler = {}

local FontMapping = {
    ["SourceSans"] = TextFontPreset.SourceSans,
    ["PressStart2P"] = TextFontPreset.PressStart2P,
    ["Montserrat"] = TextFontPreset.Montserrat,
    ["RobotoMono"] = TextFontPreset.RobotoMono,
    ["Rubik"] = TextFontPreset.Rubik,
    ["Poppins"] = TextFontPreset.Poppins,
    ["Domine"] = TextFontPreset.Domine,
    ["Fredoka"] = TextFontPreset.Fredoka,
    ["ComicNeue"] = TextFontPreset.ComicNeue,
    ["Orbitron"] = TextFontPreset.Orbitron,
    ["Papyrus"] = TextFontPreset.Papyrus,
    ["ComicSansMS"] = TextFontPreset.ComicSansMS
}

local MonospaceFonts = {
    ["PressStart2P"] = 100,
    ["RobotoMono"] = 60.01
}

local FontCharacterWidths = {
  ["SourceSans"] = {["A"] = 54.3, ["B"] = 58.8, ["C"] = 57.1, ["D"] = 61.5, ["E"] = 52.7, ["F"] = 49.4, ["G"] = 61.7, ["H"] = 65.2, ["I"] = 26.3, ["J"] = 47.9, ["K"] = 57.9, ["L"] = 48.6, ["M"] = 72.7, ["N"] = 64.7, ["O"] = 66.4, ["P"] = 56.6, ["Q"] = 66.4, ["R"] = 56.9, ["S"] = 53.4, ["T"] = 53.6, ["U"] = 64.5, ["V"] = 51.5, ["W"] = 78.6, ["X"] = 51.3, ["Y"] = 47.8, ["Z"] = 53.9, ["a"] = 50.4, ["b"] = 55.3, ["c"] = 45.6, ["d"] = 55.5, ["e"] = 49.6, ["f"] = 31.9, ["g"] = 50.4, ["h"] = 54.4, ["i"] = 24.7, ["j"] = 28.7, ["k"] = 49.5, ["l"] = 25.5, ["m"] = 82.9, ["n"] = 54.7, ["o"] = 54.2, ["p"] = 55.5, ["q"] = 55.5, ["r"] = 35, ["s"] = 41.9, ["t"] = 33.8, ["u"] = 54.4, ["v"] = 46.7, ["w"] = 71.9, ["x"] = 44.6, ["y"] = 46.7, ["z"] = 42.5, ["0"] = 49.7, ["1"] = 49.7, ["2"] = 49.7, ["3"] = 49.7, ["4"] = 49.7, ["5"] = 49.7, ["6"] = 49.7, ["7"] = 49.7, ["8"] = 49.7, ["9"] = 49.7, ["!"] = 28.9, ["@"] = 84.7, ["#"] = 49.7, ["$"] = 49.7, ["%"] = 82.4, ["^"] = 49.7, ["&"] = 60.9, ["*"] = 41.8, ["("] = 30.3, [")"] = 30.3, ["-"] = 31.1, ["_"] = 50, ["="] = 49.7, ["+"] = 49.7, ["["] = 30.3, ["]"] = 30.3, ["{"] = 30.3, ["}"] = 30.3, [";"] = 24.9, [":"] = 24.9, ["'"] = 24.9, [","] = 24.9, ["."] = 24.9, ["<"] = 49.7, [">"] = 49.7, ["/"] = 35, ["?"] = 42.5, ["|"] = 24.1, ["`"] = 54.2, ["~"] = 49.7, [" "] = 20},
  ["Montserrat"] = {["A"] = 71.7, ["B"] = 75.4, ["C"] = 70.9, ["D"] = 82.6, ["E"] = 66.9, ["F"] = 63.3, ["G"] = 77.3, ["H"] = 81.3, ["I"] = 30.2, ["J"] = 50.5, ["K"] = 71.1, ["L"] = 58.9, ["M"] = 95.5, ["N"] = 81.3, ["O"] = 83.9, ["P"] = 71.8, ["Q"] = 83.9, ["R"] = 72.3, ["S"] = 61.5, ["T"] = 57.4, ["U"] = 79.2, ["V"] = 69.8, ["W"] = 111.1, ["X"] = 65.6, ["Y"] = 63.5, ["Z"] = 65.1, ["a"] = 59, ["b"] = 67.8, ["c"] = 56.3, ["d"] = 67.8, ["e"] = 60.4, ["f"] = 37.5, ["g"] = 68.5, ["h"] = 67.6, ["i"] = 26.9, ["j"] = 36.4, ["k"] = 59.8, ["l"] = 26.9, ["m"] = 106.1, ["n"] = 67.6, ["o"] = 62.7, ["p"] = 67.8, ["q"] = 67.8, ["r"] = 40.1, ["s"] = 48.8, ["t"] = 40.6, ["u"] = 67.2, ["v"] = 54.2, ["w"] = 87.9, ["x"] = 53.4, ["y"] = 56.7, ["z"] = 51.1, ["0"] = 66.2, ["1"] = 36.1, ["2"] = 56.8, ["3"] = 56.4, ["4"] = 66.1, ["5"] = 56.6, ["6"] = 60.9, ["7"] = 58.9, ["8"] = 63.8, ["9"] = 60.9, ["!"] = 26, ["@"] = 103.3, ["#"] = 69.6, ["$"] = 61.5, ["%"] = 82.9, ["^"] = 57.6, ["&"] = 66.9, ["*"] = 38.6, ["("] = 32.9, [")"] = 32.9, ["-"] = 38.2, ["_"] = 50, ["="] = 57.5, ["+"] = 57.5, ["["] = 31.8, ["]"] = 31.8, ["{"] = 33.4, ["}"] = 33.4, [";"] = 21.2, [":"] = 21.2, ["'"] = 20.2, [","] = 21.2, ["."] = 21.2, ["<"] = 57.5, [">"] = 57.5, ["/"] = 39.5, ["?"] = 56.7, ["|"] = 29.4, ["`"] = 60, ["~"] = 57.5, [" "] = 26.2},
  ["Rubik"] = {["A"] = 67, ["B"] = 66.8, ["C"] = 66.6, ["D"] = 68.9, ["E"] = 60.6, ["F"] = 58.4, ["G"] = 68.1, ["H"] = 71.4, ["I"] = 27.3, ["J"] = 63.4, ["K"] = 60.1, ["L"] = 56.3, ["M"] = 79.4, ["N"] = 69.5, ["O"] = 67.7, ["P"] = 64.2, ["Q"] = 67.7, ["R"] = 65.5, ["S"] = 62.2, ["T"] = 57.9, ["U"] = 70.1, ["V"] = 65.5, ["W"] = 80.1, ["X"] = 63.3, ["Y"] = 64.7, ["Z"] = 60, ["a"] = 55.2, ["b"] = 59.5, ["c"] = 55.2, ["d"] = 59.5, ["e"] = 56, ["f"] = 38.5, ["g"] = 59.7, ["h"] = 60.9, ["i"] = 24.2, ["j"] = 28.8, ["k"] = 51.6, ["l"] = 24.3, ["m"] = 88.9, ["n"] = 60.6, ["o"] = 57.4, ["p"] = 59.6, ["q"] = 59.6, ["r"] = 38, ["s"] = 51, ["t"] = 39.1, ["u"] = 60.2, ["v"] = 55.4, ["w"] = 80.2, ["x"] = 53.9, ["y"] = 55.2, ["z"] = 50.9, ["0"] = 63.5, ["1"] = 42.8, ["2"] = 58.7, ["3"] = 60.1, ["4"] = 62.1, ["5"] = 59.4, ["6"] = 60.3, ["7"] = 51.3, ["8"] = 63.6, ["9"] = 59.3, ["!"] = 24.5, ["@"] = 83.2, ["#"] = 69.7, ["$"] = 61.8, ["%"] = 76.1, ["^"] = 43.2, ["&"] = 69.4, ["*"] = 44.6, ["("] = 33.9, [")"] = 33.9, ["-"] = 48.4, ["_"] = 74.8, ["="] = 57, ["+"] = 62.2, ["["] = 32.6, ["]"] = 32.6, ["{"] = 36.8, ["}"] = 36.8, [";"] = 27.1, [":"] = 25.6, ["'"] = 21.8, [","] = 24.9, ["."] = 25.2, ["<"] = 49.2, [">"] = 49.1, ["/"] = 48.2, ["?"] = 53.1, ["|"] = 23.3, ["`"] = 33.7, ["~"] = 56, [" "] = 24.5},
  ["Poppins"] = {["A"] = 67.4, ["B"] = 61.3, ["C"] = 77.2, ["D"] = 70.7, ["E"] = 51.3, ["F"] = 50.4, ["G"] = 77.8, ["H"] = 69.2, ["I"] = 24.6, ["J"] = 53, ["K"] = 59.9, ["L"] = 43.2, ["M"] = 86.1, ["N"] = 70.3, ["O"] = 78.6, ["P"] = 57.9, ["Q"] = 78.8, ["R"] = 60.8, ["S"] = 58.7, ["T"] = 54.1, ["U"] = 67.5, ["V"] = 67.6, ["W"] = 97.6, ["X"] = 62.1, ["Y"] = 58.4, ["Z"] = 54.1, ["a"] = 67.6, ["b"] = 67.6, ["c"] = 60.7, ["d"] = 67.6, ["e"] = 62, ["f"] = 32.9, ["g"] = 67.6, ["h"] = 64, ["i"] = 24.6, ["j"] = 27.5, ["k"] = 51.5, ["l"] = 24.6, ["m"] = 103, ["n"] = 64, ["o"] = 64, ["p"] = 67.6, ["q"] = 67.6, ["r"] = 37.3, ["s"] = 52.2, ["t"] = 36.4, ["u"] = 64, ["v"] = 56.1, ["w"] = 82, ["x"] = 47.9, ["y"] = 56.3, ["z"] = 45.5, ["0"] = 62.8, ["1"] = 32, ["2"] = 57.5, ["3"] = 58.9, ["4"] = 62.9, ["5"] = 62.8, ["6"] = 63.5, ["7"] = 54.6, ["8"] = 63.1, ["9"] = 63, ["!"] = 29.8, ["@"] = 101.3, ["#"] = 84, ["$"] = 62.2, ["%"] = 75.9, ["^"] = 62.9, ["&"] = 73.9, ["*"] = 48.6, ["("] = 45.4, [")"] = 45.4, ["-"] = 55.1, ["_"] = 73.3, ["="] = 72.3, ["+"] = 68.3, ["["] = 42.3, ["]"] = 42.3, ["{"] = 46.2, ["}"] = 46.2, [";"] = 26.4, [":"] = 21.3, ["'"] = 15.9, [","] = 20, ["."] = 21, ["<"] = 55.5, [">"] = 53.9, ["/"] = 47.6, ["?"] = 52.4, ["|"] = 29.1, ["`"] = 25.7, ["~"] = 51.9, [" "] = 26.7},
  ["Domine"] = {["A"] = 73.2, ["B"] = 68.4, ["C"] = 68.4, ["D"] = 76.6, ["E"] = 68.5, ["F"] = 63.6, ["G"] = 75.3, ["H"] = 80.3, ["I"] = 37.4, ["J"] = 58.3, ["K"] = 75, ["L"] = 62.9, ["M"] = 96.1, ["N"] = 80.1, ["O"] = 76.4, ["P"] = 63.1, ["Q"] = 76.4, ["R"] = 70.6, ["S"] = 59.9, ["T"] = 65.8, ["U"] = 77.2, ["V"] = 72.7, ["W"] = 104.7, ["X"] = 74, ["Y"] = 68.4, ["Z"] = 64.7, ["a"] = 53.7, ["b"] = 60.1, ["c"] = 53.6, ["d"] = 62, ["e"] = 54.4, ["f"] = 43, ["g"] = 56, ["h"] = 64.4, ["i"] = 31.2, ["j"] = 36.7, ["k"] = 59.6, ["l"] = 30.8, ["m"] = 97.5, ["n"] = 65.5, ["o"] = 58.2, ["p"] = 61.9, ["q"] = 60.1, ["r"] = 45.8, ["s"] = 50.3, ["t"] = 34.1, ["u"] = 63.3, ["v"] = 59.3, ["w"] = 87.7, ["x"] = 57.3, ["y"] = 59, ["z"] = 53.8, ["0"] = 67.4, ["1"] = 40, ["2"] = 58.9, ["3"] = 58, ["4"] = 55.9, ["5"] = 55, ["6"] = 60.3, ["7"] = 51.3, ["8"] = 57.2, ["9"] = 60.3, ["!"] = 28.5, ["@"] = 80.8, ["#"] = 73.6, ["$"] = 56.8, ["%"] = 67.9, ["^"] = 38.2, ["&"] = 76.7, ["*"] = 47, ["("] = 37.1, [")"] = 37.1, ["-"] = 38.9, ["_"] = 63.2, ["="] = 57.6, ["+"] = 48.8, ["["] = 36.8, ["]"] = 36.8, ["{"] = 40.4, ["}"] = 40.4, [";"] = 28.7, [":"] = 26.5, ["'"] = 20.9, [","] = 24.7, ["."] = 24, ["<"] = 47.1, [">"] = 47.1, ["/"] = 31, ["?"] = 48.1, ["|"] = 24.5, ["`"] = 25.9, ["~"] = 48.5, [" "] = 25.4},
  ["Fredoka"] = {["A"] = 70.4, ["B"] = 63.8, ["C"] = 66.7, ["D"] = 69.2, ["E"] = 62.3, ["F"] = 63.1, ["G"] = 70.8, ["H"] = 68.7, ["I"] = 21.7, ["J"] = 54.5, ["K"] = 59.1, ["L"] = 55.8, ["M"] = 82.5, ["N"] = 70.8, ["O"] = 73.2, ["P"] = 60.1, ["Q"] = 81.1, ["R"] = 62.4, ["S"] = 55.4, ["T"] = 66.4, ["U"] = 71.3, ["V"] = 72.4, ["W"] = 96.5, ["X"] = 69.4, ["Y"] = 63.8, ["Z"] = 57.5, ["a"] = 57.4, ["b"] = 58.2, ["c"] = 50.8, ["d"] = 58.6, ["e"] = 54, ["f"] = 37.8, ["g"] = 56.5, ["h"] = 53.5, ["i"] = 22.4, ["j"] = 32.5, ["k"] = 48.9, ["l"] = 28.1, ["m"] = 82.6, ["n"] = 55.7, ["o"] = 56, ["p"] = 57.4, ["q"] = 56.8, ["r"] = 40.6, ["s"] = 45.9, ["t"] = 37.6, ["u"] = 54.3, ["v"] = 53.7, ["w"] = 76.3, ["x"] = 49.4, ["y"] = 52.6, ["z"] = 53.1, ["0"] = 58.7, ["1"] = 39.2, ["2"] = 59.8, ["3"] = 58.7, ["4"] = 54.4, ["5"] = 51.6, ["6"] = 53.6, ["7"] = 55.4, ["8"] = 55.9, ["9"] = 53.6, ["!"] = 23.1, ["@"] = 82.9, ["#"] = 79.6, ["$"] = 46.7, ["%"] = 82.3, ["^"] = 50.9, ["&"] = 71.3, ["*"] = 49.4, ["("] = 37.7, [")"] = 37.7, ["-"] = 42.6, ["_"] = 81.2, ["="] = 46.5, ["+"] = 53.7, ["["] = 34.2, ["]"] = 34.2, ["{"] = 37.4, ["}"] = 37.4, [";"] = 21.3, [":"] = 23.4, ["'"] = 18.1, [","] = 22.5, ["."] = 21.1, ["<"] = 51.3, [">"] = 51.3, ["/"] = 51.7, ["?"] = 49.1, ["|"] = 21.3, ["`"] = 33.4, ["~"] = 55.2, [" "] = 25.4},
  ["ComicNeue"] = {["A"] = 58.1, ["B"] = 62, ["C"] = 61.4, ["D"] = 62.9, ["E"] = 60.3, ["F"] = 57.7, ["G"] = 71.6, ["H"] = 72.3, ["I"] = 39.2, ["J"] = 45.7, ["K"] = 56, ["L"] = 50, ["M"] = 83.8, ["N"] = 65.8, ["O"] = 64.3, ["P"] = 56, ["Q"] = 70.8, ["R"] = 59.6, ["S"] = 55.2, ["T"] = 52.2, ["U"] = 69.1, ["V"] = 53.6, ["W"] = 86.7, ["X"] = 68.5, ["Y"] = 59.4, ["Z"] = 58.2, ["a"] = 51.6, ["b"] = 53.5, ["c"] = 48.2, ["d"] = 53, ["e"] = 50.1, ["f"] = 34.3, ["g"] = 53, ["h"] = 53.6, ["i"] = 22.7, ["j"] = 32.9, ["k"] = 48.4, ["l"] = 21.9, ["m"] = 82.7, ["n"] = 55.3, ["o"] = 52.9, ["p"] = 53.1, ["q"] = 52, ["r"] = 39.7, ["s"] = 41.6, ["t"] = 34.9, ["u"] = 51.1, ["v"] = 42.3, ["w"] = 59.8, ["x"] = 48.8, ["y"] = 45, ["z"] = 43.4, ["0"] = 60.9, ["1"] = 39.6, ["2"] = 52.3, ["3"] = 50.6, ["4"] = 48.4, ["5"] = 54.2, ["6"] = 54.2, ["7"] = 47.3, ["8"] = 51.5, ["9"] = 53.1, ["!"] = 24.5, ["@"] = 83.2, ["#"] = 74, ["$"] = 60.2, ["%"] = 72, ["^"] = 50.4, ["&"] = 64.4, ["*"] = 39.4, ["("] = 34.6, [")"] = 34.6, ["-"] = 40.2, ["_"] = 54.5, ["="] = 46.2, ["+"] = 44.4, ["["] = 31.8, ["]"] = 31.8, ["{"] = 37.3, ["}"] = 37.3, [";"] = 19.9, [":"] = 18.1, ["'"] = 19.6, [","] = 16.4, ["."] = 15.3, ["<"] = 51.1, [">"] = 54.1, ["/"] = 43.6, ["?"] = 50.1, ["|"] = 19.7, ["`"] = 18.1, ["~"] = 61.5, [" "] = 33.4},
  ["Orbitron"] = {["A"] = 83.6, ["B"] = 83.2, ["C"] = 82.2, ["D"] = 83.4, ["E"] = 76.6, ["F"] = 72.3, ["G"] = 83, ["H"] = 85.1, ["I"] = 21.4, ["J"] = 78, ["K"] = 79.7, ["L"] = 77.9, ["M"] = 92.8, ["N"] = 83.2, ["O"] = 82.8, ["P"] = 79.1, ["Q"] = 88.4, ["R"] = 82.5, ["S"] = 82.2, ["T"] = 75.9, ["U"] = 82.8, ["V"] = 100.3, ["W"] = 117.9, ["X"] = 81.2, ["Y"] = 80.6, ["Z"] = 82.1, ["a"] = 69.4, ["b"] = 66.7, ["c"] = 69.5, ["d"] = 66.7, ["e"] = 69.2, ["f"] = 40.7, ["g"] = 68.3, ["h"] = 66.8, ["i"] = 20.8, ["j"] = 42.6, ["k"] = 64.6, ["l"] = 30.2, ["m"] = 97.8, ["n"] = 69.6, ["o"] = 69.2, ["p"] = 66.4, ["q"] = 66.4, ["r"] = 51.2, ["s"] = 68.6, ["t"] = 41, ["u"] = 69.5, ["v"] = 79, ["w"] = 107.1, ["x"] = 69.2, ["y"] = 68.5, ["z"] = 69.8, ["0"] = 83.4, ["1"] = 39.1, ["2"] = 83, ["3"] = 82.6, ["4"] = 73, ["5"] = 83, ["6"] = 82, ["7"] = 66, ["8"] = 83.4, ["9"] = 82.8, ["!"] = 22, ["@"] = 83.2, ["#"] = 79.7, ["$"] = 78.8, ["%"] = 96.6, ["^"] = 50, ["&"] = 93.8, ["*"] = 49.1, ["("] = 27.7, [")"] = 27.8, ["-"] = 51.7, ["_"] = 82.8, ["="] = 63.8, ["+"] = 43.3, ["["] = 27.5, ["]"] = 27.6, ["{"] = 28.9, ["}"] = 28.9, [";"] = 19.3, [":"] = 21.4, ["'"] = 22.4, [","] = 19.3, ["."] = 21.4, ["<"] = 47.3, [">"] = 47.5, ["/"] = 52.1, ["?"] = 67.8, ["|"] = 21.4, ["`"] = 31.5, ["~"] = 40.4, [" "] = 27.2},
  ["Papyrus"] = {["A"] = 97.61, ["B"] = 96.83, ["C"] = 100.2, ["D"] = 98.78, ["E"] = 98.54, ["F"] = 75.34, ["G"] = 101.8, ["H"] = 98.88, ["I"] = 27.34, ["J"] = 68.22, ["K"] = 88.68, ["L"] = 74.61, ["M"] = 103, ["N"] = 93.85, ["O"] = 109.8, ["P"] = 66.36, ["Q"] = 129.4, ["R"] = 79.64, ["S"] = 96.58, ["T"] = 95.17, ["U"] = 102.5, ["V"] = 77.15, ["W"] = 106.5, ["X"] = 76.81, ["Y"] = 83.5, ["Z"] = 83.74, ["a"] = 50.98, ["b"] = 56.74, ["c"] = 46.68, ["d"] = 56.05, ["e"] = 51.46, ["f"] = 36.82, ["g"] = 55.14, ["h"] = 51.22, ["i"] = 21.24, ["j"] = 43.9, ["k"] = 47.66, ["l"] = 20.02, ["m"] = 63.96, ["n"] = 51.12, ["o"] = 56.64, ["p"] = 57.37, ["q"] = 54, ["r"] = 36.77, ["s"] = 44.63, ["t"] = 34.81, ["u"] = 52.1, ["v"] = 40.67, ["w"] = 61.08, ["x"] = 43.21, ["y"] = 51.38, ["z"] = 39.01, ["0"] = 57.37, ["1"] = 57.37, ["2"] = 57.37, ["3"] = 57.37, ["4"] = 57.37, ["5"] = 57.37, ["6"] = 57.37, ["7"] = 57.37, ["8"] = 57.37, ["9"] = 57.37, ["!"] = 21.34, ["@"] = 78.47, ["#"] = 57.37, ["$"] = 57.37, ["%"] = 65.63, ["^"] = 57.37, ["&"] = 66.26, ["*"] = 34.67, ["("] = 31.93, [")"] = 31.93, ["-"] = 33.84, ["_"] = 57.37, ["="] = 57.37, ["+"] = 57.37, ["["] = 31.93, ["]"] = 31.93, ["{"] = 40.67, ["}"] = 40.82, [";"] = 21.34, [":"] = 21.34, ["'"] = 21.34, [","] = 21.34, ["."] = 21.34, ["<"] = 57.37, [">"] = 57.37, ["/"] = 73.5, ["?"] = 39.36, ["|"] = 57.37, ["`"] = 40.82, ["~"] = 57.37, [" "] = 21.34},
  ["ComicSansMS"] = {["A"] = 73.14, ["B"] = 63.14, ["C"] = 68.61, ["D"] = 72.17, ["E"] = 70.17, ["F"] = 69.49, ["G"] = 67.97, ["H"] = 82.48, ["I"] = 62.11, ["J"] = 72.95, ["K"] = 68.75, ["L"] = 55.08, ["M"] = 88.28, ["N"] = 83.89, ["O"] = 81.25, ["P"] = 57.96, ["Q"] = 87.65, ["R"] = 63.48, ["S"] = 70.07, ["T"] = 77.06, ["U"] = 77.06, ["V"] = 75.69, ["W"] = 113.6, ["X"] = 79.55, ["Y"] = 70.71, ["Z"] = 77.69, ["a"] = 51.52, ["b"] = 59.33, ["c"] = 51.81, ["d"] = 63.92, ["e"] = 54.79, ["f"] = 58.26, ["g"] = 56.31, ["h"] = 57.76, ["i"] = 32.23, ["j"] = 48.54, ["k"] = 57.52, ["l"] = 30.77, ["m"] = 77.69, ["n"] = 52.35, ["o"] = 52.59, ["p"] = 53.57, ["q"] = 52.06, ["r"] = 51.37, ["s"] = 50.74, ["t"] = 48.59, ["u"] = 55.13, ["v"] = 54.74, ["w"] = 73.05, ["x"] = 63.97, ["y"] = 58.16, ["z"] = 57.82, ["0"] = 63.34, ["1"] = 45.02, ["2"] = 62.21, ["3"] = 61.04, ["4"] = 61.87, ["5"] = 64.85, ["6"] = 61.04, ["7"] = 70.07, ["8"] = 61.04, ["9"] = 64.46, ["!"] = 28.33, ["@"] = 93.12, ["#"] = 91.02, ["$"] = 69.34, ["%"] = 82.03, ["^"] = 59.43, ["&"] = 65.43, ["*"] = 56.45, ["("] = 41.36, [")"] = 39.21, ["-"] = 41.65, ["_"] = 67.59, ["="] = 51.03, ["+"] = 48.88, ["["] = 42.68, ["]"] = 45.46, ["{"] = 45.46, ["}"] = 39.32, [";"] = 29.88, [":"] = 29.88, ["'"] = 38.82, [","] = 27.69, ["."] = 24.9, ["<"] = 38.13, [">"] = 40.97, ["/"] = 59.14, ["?"] = 54.45, ["|"] = 42.14, ["`"] = 55.62, ["~"] = 61.97, [" "] = 29.88}
}

local function GetFontName(Text3D)
    for FontName, FontEnum in pairs(FontMapping) do
        if Text3D.Font == FontEnum then
            return FontName
        end
    end

    return "SourceSans"
end

local function CalculateTextwidth(Text, FontName)
    local MonoWidth = MonospaceFonts[FontName]
    if MonoWidth then
        return #Text * MonoWidth
    end
    
    local CharWidths = FontCharacterWidths[FontName] or FontCharacterWidths["SourceSans"]
    local TotalWidth = 0
    
    for I = 1, #Text, 1 do
        local Char = Text:sub(I, I)
        local Width = CharWidths[Char] or 48
        TotalWidth = TotalWidth + Width
    end
    
    return TotalWidth
end

function Text3DScaler.ScaleText(Text3D, MaxWidth, MaxHeight)
    local FontName = GetFontName(Text3D)
    local FullSize = CalculateTextwidth(Text3D.Text, FontName)
    
    local WidthScale = MaxWidth / FullSize / Text3D.FontSize * 1000
    local HeightScale = MaxHeight / Text3D.FontSize * 10
    
    local NewSize = math.min(WidthScale, HeightScale)
    Text3D.Size = Vector3.New(NewSize, NewSize, 1)
end

function Text3DScaler.SetTextAndScale(Text3D, Text, MaxWidth, MaxHeight)
    local FontName = GetFontName(Text3D)
    local FullSize = CalculateTextwidth(Text, FontName)
    
    local WidthScale = MaxWidth / FullSize / Text3D.FontSize * 1000
    local HeightScale = MaxHeight / Text3D.FontSize * 10
    
    local NewSize = math.min(WidthScale, HeightScale)
    
    Text3D.Text = Text
    Text3D.Size = Vector3.New(NewSize, NewSize, 1)
end

return Text3DScaler
